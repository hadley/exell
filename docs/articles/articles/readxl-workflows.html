<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>readxl Workflows • readxl</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- tidyverse --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">readxl</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/cell-and-column-types.html">Column Types</a>
    </li>
    <li>
      <a href="../../articles/sheet-geometry.html">Sheet Geometry</a>
    </li>
    <li>
      <a href="../../articles/articles/readxl-workflows.html">Workflows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/readxl">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>readxl Workflows</h1>
            
          </div>

    
    
<div class="contents">
<p>Ideas for using readxl to increase reproducibiliy and reduce tedium.</p>
<p>Reproducibility is much easier in theory than in reality. Here are some special dilemmas we face with spreadsheets:</p>
<ul>
<li>We say: Keep raw data raw! But we also say: Store data in a tool-agnostic, future-proof format! If data comes in the form of an <code>.xls[x]</code> file, we’re in a pickle. The <code>.xls[x]</code> file should obviously be preserved, and probably write-protected. But a faithful copy as CSV is a wonderful complement, as long as you can ensure the two are the same.</li>
<li>We say: Don’t do analysis “by hand” or “by mouse”! But then we break this rule by manually exporting spreadsheets to file with <em>File &gt; Save As … &gt; (save to <code>.csv</code>)</em>. readxl helps you get data directly out of a spreadsheet and into R, where you can record every step of your analysis as code. Below we show how to cache a CSV snapshot as part of this process.</li>
</ul>
<p>The examples below also demonstrate the use of functional programming or “apply” techniques to iterate over the worksheets in a workbook.</p>
<div id="load-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h2>
<p>We load the tidyverse metapackage here because the workflows below show readxl working with readr, purrr, etc. See the last section for solutions using base R only (other than readxl).</p>
<p>We must load readxl explicitly because it is not part of the core tidyverse.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="co">#&gt; Loading tidyverse: ggplot2</span>
<span class="co">#&gt; Loading tidyverse: tibble</span>
<span class="co">#&gt; Loading tidyverse: tidyr</span>
<span class="co">#&gt; Loading tidyverse: readr</span>
<span class="co">#&gt; Loading tidyverse: purrr</span>
<span class="co">#&gt; Loading tidyverse: dplyr</span>
<span class="co">#&gt; Conflicts with tidy packages ----------------------------------------------</span>
<span class="co">#&gt; filter(): dplyr, stats</span>
<span class="co">#&gt; lag():    dplyr, stats</span>
<span class="kw">library</span>(readxl)</code></pre></div>
</div>
<div id="cache-a-csv-snapshot" class="section level2">
<h2 class="hasAnchor">
<a href="#cache-a-csv-snapshot" class="anchor"></a>Cache a CSV snapshot</h2>
<p>Break analyses into logical steps, via a series of scripts that relate to one theme, such as “clean the data” or “make exploratory and diagnostic plots”.</p>
<p>This forces you to transmit info from step i to step i + 1 via a set of output files. The cumulative outputs of steps 1, 2, …, i are available as inputs for steps i + 1.</p>
<p>These outputs constitute an API for your analysis, i.e. they provide clean entry points that can be used (and understood) in isolation, possibly using an entirely different toolkit. Contrast this with the alternative of writing one monolithic script or transmitting entire workspaces via <code>save()</code>, <code>load()</code>, and R-specific <code>.rds</code> files.</p>
<p>If raw data is stored <em>only</em> as an Excel spreadsheet, this limits your ability to inspect it when solving the little puzzles that crop up in dowstream work. You’ll need to fire up Excel (or similar) and get busy with your mouse. You certainly can’t poke around it or view diffs on GitHub.</p>
<p>Solution: cache a CSV snapshot of your raw data tables at the time of export. Even if you use <code><a href="../../reference/read_excel.html">read_excel()</a></code> for end-to-end reproducibility, this complementary CSV leaves your analysis in a more accessible state.</p>
<p>Pipe the output of <code><a href="../../reference/read_excel.html">read_excel()</a></code> directly into <code>readr::write_csv()</code> like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_xl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">sheet =</span> <span class="st">"iris"</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">write_csv</span>(<span class="st">"iris-raw.csv"</span>)</code></pre></div>
<p>Why does this work? <code>readr::write_csv()</code> is a well-mannered “write” function: it does its main job <em>and returns its input invisibly</em>. The above command reads the iris sheet from readxl’s <code>datasets.xlsx</code> example workbook and caches a CSV version of the resulting data frame to file.</p>
<p>Let’s check. Did we still import the data? Did we write the CSV file?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_xl
<span class="co">#&gt; # A tibble: 150 × 5</span>
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;chr&gt;</span>
<span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span>
<span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span>
<span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span>
<span class="co">#&gt; # ... with 147 more rows</span>
<span class="kw">dir</span>(<span class="dt">pattern =</span> <span class="st">"iris"</span>)
<span class="co">#&gt; [1] "iris-raw.csv"</span></code></pre></div>
<p>Yes! Is the data written to CSV an exact copy of what we imported from Excel?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_alt &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"iris-raw.csv"</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   Sepal.Length = col_double(),</span>
<span class="co">#&gt;   Sepal.Width = col_double(),</span>
<span class="co">#&gt;   Petal.Length = col_double(),</span>
<span class="co">#&gt;   Petal.Width = col_double(),</span>
<span class="co">#&gt;   Species = col_character()</span>
<span class="co">#&gt; )</span>
## readr leaves a note-to-self in `spec` that records its column guessing,
## so we remove that attribute before the check
<span class="kw">attr</span>(iris_alt, <span class="st">"spec"</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">identical</span>(iris_xl, iris_alt)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Yes! If we needed to restart or troubleshoot this fictional analysis, <code>iris-raw.csv</code> is available as a second, highly accessible alternative to <code>datasets.xlsx</code>.</p>
</div>
<div id="iterate-over-multiple-worksheets-in-a-workbook" class="section level2">
<h2 class="hasAnchor">
<a href="#iterate-over-multiple-worksheets-in-a-workbook" class="anchor"></a>Iterate over multiple worksheets in a workbook</h2>
<p>Some Excel workbooks contain only data and you are tempted to ask “Why, God, why is this data stored in Excel? Why not store this as a series of CSV files?” One possible answer is this: because the workbook structure keeps them all together.</p>
<p>Let’s accept that this happens and that it is not entirely crazy. How can you efficiently load all of that into R?</p>
<p>Here’s how to load all the sheets in a workbook into a list of data frames:</p>
<ul>
<li>Get worksheet names as a self-named character vector (these names propagate nicely).</li>
<li>Use <code>purrr::map()</code> to iterate sheet reading.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>)
path %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">set_names</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">map</span>(read_excel, <span class="dt">path =</span> path)
<span class="co">#&gt; $iris</span>
<span class="co">#&gt; # A tibble: 150 × 5</span>
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;chr&gt;</span>
<span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span>
<span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span>
<span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span>
<span class="co">#&gt; # ... with 147 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $mtcars</span>
<span class="co">#&gt; # A tibble: 32 × 11</span>
<span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  21.0     6   160   110  3.90 2.620 16.46     0     1     4     4</span>
<span class="co">#&gt; 2  21.0     6   160   110  3.90 2.875 17.02     0     1     4     4</span>
<span class="co">#&gt; 3  22.8     4   108    93  3.85 2.320 18.61     1     1     4     1</span>
<span class="co">#&gt; # ... with 29 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $chickwts</span>
<span class="co">#&gt; # A tibble: 71 × 2</span>
<span class="co">#&gt;   weight      feed</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;chr&gt;</span>
<span class="co">#&gt; 1    179 horsebean</span>
<span class="co">#&gt; 2    160 horsebean</span>
<span class="co">#&gt; 3    136 horsebean</span>
<span class="co">#&gt; # ... with 68 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $quakes</span>
<span class="co">#&gt; # A tibble: 1,000 × 5</span>
<span class="co">#&gt;      lat   long depth   mag stations</span>
<span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -20.42 181.62   562   4.8       41</span>
<span class="co">#&gt; 2 -20.62 181.03   650   4.2       15</span>
<span class="co">#&gt; 3 -26.00 184.10    42   5.4       43</span>
<span class="co">#&gt; # ... with 997 more rows</span></code></pre></div>
</div>
<div id="csv-caching-and-iterating-over-sheets" class="section level2">
<h2 class="hasAnchor">
<a href="#csv-caching-and-iterating-over-sheets" class="anchor"></a>CSV caching and iterating over sheets</h2>
<p>What if we want to read all the sheets in at once and simultaneously cache to CSV? We define <code>read_then_csv()</code> as <code>read_excel(...) %&gt;% write_csv()</code> and use <code>purrr::map()</code> again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_then_csv &lt;-<span class="st"> </span>function(sheet, path) {
  pathbase &lt;-<span class="st"> </span>path %&gt;%
<span class="st">    </span><span class="kw">basename</span>() %&gt;%
<span class="st">    </span>tools::<span class="kw">file_path_sans_ext</span>()
  path %&gt;%
<span class="st">    </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">sheet =</span> sheet) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">write_csv</span>(<span class="kw">paste0</span>(pathbase, <span class="st">"-"</span>, sheet, <span class="st">".csv"</span>))
}</code></pre></div>
<p>We could even define this on-the-fly as an anonymous function inside <code>map()</code>, but I think this is more readable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>)
path %&gt;%
<span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() %&gt;%
<span class="st">  </span><span class="kw">set_names</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">map</span>(read_then_csv, <span class="dt">path =</span> path)
<span class="co">#&gt; $iris</span>
<span class="co">#&gt; # A tibble: 150 × 5</span>
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;chr&gt;</span>
<span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span>
<span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span>
<span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span>
<span class="co">#&gt; # ... with 147 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $mtcars</span>
<span class="co">#&gt; # A tibble: 32 × 11</span>
<span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  21.0     6   160   110  3.90 2.620 16.46     0     1     4     4</span>
<span class="co">#&gt; 2  21.0     6   160   110  3.90 2.875 17.02     0     1     4     4</span>
<span class="co">#&gt; 3  22.8     4   108    93  3.85 2.320 18.61     1     1     4     1</span>
<span class="co">#&gt; # ... with 29 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $chickwts</span>
<span class="co">#&gt; # A tibble: 71 × 2</span>
<span class="co">#&gt;   weight      feed</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;chr&gt;</span>
<span class="co">#&gt; 1    179 horsebean</span>
<span class="co">#&gt; 2    160 horsebean</span>
<span class="co">#&gt; 3    136 horsebean</span>
<span class="co">#&gt; # ... with 68 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $quakes</span>
<span class="co">#&gt; # A tibble: 1,000 × 5</span>
<span class="co">#&gt;      lat   long depth   mag stations</span>
<span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -20.42 181.62   562   4.8       41</span>
<span class="co">#&gt; 2 -20.62 181.03   650   4.2       15</span>
<span class="co">#&gt; 3 -26.00 184.10    42   5.4       43</span>
<span class="co">#&gt; # ... with 997 more rows</span>
<span class="kw">dir</span>(<span class="dt">pattern =</span> <span class="st">"^datasets.*</span><span class="ch">\\</span><span class="st">.csv$"</span>)
<span class="co">#&gt; [1] "datasets-chickwts.csv" "datasets-iris.csv"     "datasets-mtcars.csv"  </span>
<span class="co">#&gt; [4] "datasets-quakes.csv"</span></code></pre></div>
<p>In a real analysis, starting with workbook <code>"foo.xlsx"</code>, you might want to create the directory <code>foo</code> and place the CSVs inside that.</p>
</div>
<div id="concatenate-worksheets-into-one-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#concatenate-worksheets-into-one-data-frame" class="anchor"></a>Concatenate worksheets into one data frame</h2>
<p>What if the datasets found on different sheets have the same variables? Then you’ll want to row-bind them, after import, to form one big, beautiful data frame.</p>
<p>readxl ships with an example sheet <code>deaths.xlsx</code>, containing data on famous people who died in 2016 or 2017. It has two worksheets named “arts” and “other”, but the spreadsheet layout is the same in each and the data tables have the same variables, e.g., name and date of death.</p>
<p>The <code>map_df()</code> function from purrr makes it easy to iterate over worksheets and glue together the resulting data frames, all at once.</p>
<ul>
<li>Store a self-named vector of worksheet names (critical for the ID variable below).</li>
<li>Use <code>purrr::map_df()</code> to import the data, create an ID variable for the source worksheet, and row bind.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)
deaths &lt;-<span class="st"> </span>path %&gt;%
<span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() %&gt;%
<span class="st">  </span><span class="kw">set_names</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">map_df</span>(~<span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">path =</span> path, <span class="dt">sheet =</span> .x, <span class="dt">range =</span> <span class="st">"A5:F15"</span>), <span class="dt">.id =</span> <span class="st">"sheet"</span>)
<span class="kw">print</span>(deaths, <span class="dt">n =</span> <span class="ot">Inf</span>)
<span class="co">#&gt; # A tibble: 20 × 7</span>
<span class="co">#&gt;    sheet               Name Profession   Age `Has kids` `Date of birth`</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;      &lt;lgl&gt;          &lt;dttm&gt;</span>
<span class="co">#&gt; 1   arts        David Bowie   musician    69       TRUE      1947-01-08</span>
<span class="co">#&gt; 2   arts      Carrie Fisher      actor    60       TRUE      1956-10-21</span>
<span class="co">#&gt; 3   arts        Chuck Berry   musician    90       TRUE      1926-10-18</span>
<span class="co">#&gt; 4   arts        Bill Paxton      actor    61       TRUE      1955-05-17</span>
<span class="co">#&gt; 5   arts             Prince   musician    57       TRUE      1958-06-07</span>
<span class="co">#&gt; 6   arts       Alan Rickman      actor    69      FALSE      1946-02-21</span>
<span class="co">#&gt; 7   arts Florence Henderson      actor    82       TRUE      1934-02-14</span>
<span class="co">#&gt; 8   arts         Harper Lee     author    89      FALSE      1926-04-28</span>
<span class="co">#&gt; 9   arts      Zsa Zsa Gábor      actor    99       TRUE      1917-02-06</span>
<span class="co">#&gt; 10  arts     George Michael   musician    53      FALSE      1963-06-25</span>
<span class="co">#&gt; 11 other         Vera Rubin  scientist    88       TRUE      1928-07-23</span>
<span class="co">#&gt; 12 other        Mohamed Ali    athlete    74       TRUE      1942-01-17</span>
<span class="co">#&gt; 13 other       Morley Safer journalist    84       TRUE      1931-11-08</span>
<span class="co">#&gt; 14 other       Fidel Castro politician    90       TRUE      1926-08-13</span>
<span class="co">#&gt; 15 other     Antonin Scalia     lawyer    79       TRUE      1936-03-11</span>
<span class="co">#&gt; 16 other             Jo Cox politician    41       TRUE      1974-06-22</span>
<span class="co">#&gt; 17 other         Janet Reno     lawyer    78      FALSE      1938-07-21</span>
<span class="co">#&gt; 18 other         Gwen Ifill journalist    61      FALSE      1955-09-29</span>
<span class="co">#&gt; 19 other         John Glenn  astronaut    95       TRUE      1921-07-28</span>
<span class="co">#&gt; 20 other         Pat Summit      coach    64       TRUE      1952-06-14</span>
<span class="co">#&gt; # ... with 1 more variables: `Date of death` &lt;dttm&gt;</span></code></pre></div>
<p>Note the use of <code>range = "A5:E15"</code> here. <code>deaths.xlsx</code> is a typical spreadsheet and includes a few non-data lines at the top and bottom and this argument specifies where the data rectangle lives.</p>
</div>
<div id="putting-it-all-together" class="section level2">
<h2 class="hasAnchor">
<a href="#putting-it-all-together" class="anchor"></a>Putting it all together</h2>
<p>All at once now:</p>
<ul>
<li>Multiple worksheets feeding into one data frame</li>
<li>Sheet-specific target rectangles</li>
<li>Cache to CSV upon import</li>
</ul>
<p>Even though the worksheets in <code>deaths.xlsx</code> have the same layout, we’ll pretend they don’t and specify the target rectangle in two different ways here. This shows how this can work if each worksheet has it’s own peculiar geometry. Here’s the workflow:</p>
<ul>
<li>Store a self-named vector of worksheet names.</li>
<li>Store a vector of cell range specifications.</li>
<li>Use <code>purrr::map2_df()</code> to iterate over those two vectors in parallel, importing the data, row binding, and creating an ID variable for the source worksheet.</li>
<li>Cache the unified data to CSV.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)
sheets &lt;-<span class="st"> </span>path %&gt;%
<span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">set_names</span>()
ranges &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">"A5:F15"</span>, <span class="kw"><a href="../../reference/cell-specification.html">cell_rows</a></span>(<span class="dv">5</span>:<span class="dv">15</span>))
deaths &lt;-<span class="st"> </span><span class="kw">map2_df</span>(
  sheets,
  ranges,
  ~<span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(path, <span class="dt">sheet =</span> .x, <span class="dt">range =</span> .y),
  <span class="dt">.id =</span> <span class="st">"sheet"</span>
) %&gt;%
<span class="st">  </span><span class="kw">write_csv</span>(<span class="st">"deaths.csv"</span>)
<span class="kw">print</span>(deaths, <span class="dt">n =</span> <span class="ot">Inf</span>)
<span class="co">#&gt; # A tibble: 20 × 7</span>
<span class="co">#&gt;    sheet               Name Profession   Age `Has kids` `Date of birth`</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;      &lt;lgl&gt;          &lt;dttm&gt;</span>
<span class="co">#&gt; 1   arts        David Bowie   musician    69       TRUE      1947-01-08</span>
<span class="co">#&gt; 2   arts      Carrie Fisher      actor    60       TRUE      1956-10-21</span>
<span class="co">#&gt; 3   arts        Chuck Berry   musician    90       TRUE      1926-10-18</span>
<span class="co">#&gt; 4   arts        Bill Paxton      actor    61       TRUE      1955-05-17</span>
<span class="co">#&gt; 5   arts             Prince   musician    57       TRUE      1958-06-07</span>
<span class="co">#&gt; 6   arts       Alan Rickman      actor    69      FALSE      1946-02-21</span>
<span class="co">#&gt; 7   arts Florence Henderson      actor    82       TRUE      1934-02-14</span>
<span class="co">#&gt; 8   arts         Harper Lee     author    89      FALSE      1926-04-28</span>
<span class="co">#&gt; 9   arts      Zsa Zsa Gábor      actor    99       TRUE      1917-02-06</span>
<span class="co">#&gt; 10  arts     George Michael   musician    53      FALSE      1963-06-25</span>
<span class="co">#&gt; 11 other         Vera Rubin  scientist    88       TRUE      1928-07-23</span>
<span class="co">#&gt; 12 other        Mohamed Ali    athlete    74       TRUE      1942-01-17</span>
<span class="co">#&gt; 13 other       Morley Safer journalist    84       TRUE      1931-11-08</span>
<span class="co">#&gt; 14 other       Fidel Castro politician    90       TRUE      1926-08-13</span>
<span class="co">#&gt; 15 other     Antonin Scalia     lawyer    79       TRUE      1936-03-11</span>
<span class="co">#&gt; 16 other             Jo Cox politician    41       TRUE      1974-06-22</span>
<span class="co">#&gt; 17 other         Janet Reno     lawyer    78      FALSE      1938-07-21</span>
<span class="co">#&gt; 18 other         Gwen Ifill journalist    61      FALSE      1955-09-29</span>
<span class="co">#&gt; 19 other         John Glenn  astronaut    95       TRUE      1921-07-28</span>
<span class="co">#&gt; 20 other         Pat Summit      coach    64       TRUE      1952-06-14</span>
<span class="co">#&gt; # ... with 1 more variables: `Date of death` &lt;dttm&gt;</span></code></pre></div>
<!--

## Session info

<details>
<summary>devtools::session_info()</summary>

```r
devtools::session_info()
#> Session info -------------------------------------------------------------
#>  setting  value                       
#>  version  R version 3.3.2 (2016-10-31)
#>  system   x86_64, darwin13.4.0        
#>  ui       X11                         
#>  language (EN)                        
#>  collate  en_CA.UTF-8                 
#>  tz       America/Vancouver           
#>  date     2017-04-13
#> Packages -----------------------------------------------------------------
#>  package    * version     date       source                              
#>  assertthat   0.2.0       2017-04-11 cran (@0.2.0)                       
#>  backports    1.0.5       2017-01-18 cran (@1.0.5)                       
#>  broom        0.4.2       2017-02-13 cran (@0.4.2)                       
#>  cellranger   1.1.0       2016-07-27 CRAN (R 3.3.0)                      
#>  colorspace   1.3-2       2016-12-14 CRAN (R 3.3.2)                      
#>  devtools     1.12.0.9000 2017-04-13 Github (hadley/devtools@ab176e6)    
#>  digest       0.6.12      2017-01-27 cran (@0.6.12)                      
#>  dplyr      * 0.5.0.9001  2017-04-13 Github (hadley/dplyr@22504ec)       
#>  evaluate     0.10        2016-10-11 cran (@0.10)                        
#>  forcats      0.2.0       2017-01-23 cran (@0.2.0)                       
#>  foreign      0.8-67      2016-09-13 CRAN (R 3.3.2)                      
#>  ggplot2    * 2.2.1       2016-12-30 CRAN (R 3.3.2)                      
#>  glue         0.0.0.9000  2017-04-03 Github (tidyverse/glue@6e77c3b)     
#>  gtable       0.2.0       2016-02-26 CRAN (R 3.3.0)                      
#>  haven        1.0.0       2016-09-23 CRAN (R 3.3.0)                      
#>  hms          0.3         2016-11-22 CRAN (R 3.3.2)                      
#>  htmltools    0.3.5       2016-03-21 CRAN (R 3.2.4)                      
#>  httr         1.2.1.9000  2016-11-22 Github (gaborcsardi/httr@30001d4)   
#>  jsonlite     1.4         2017-04-08 cran (@1.4)                         
#>  knitr        1.15.1      2016-11-22 CRAN (R 3.3.2)                      
#>  lattice      0.20-34     2016-09-06 CRAN (R 3.3.2)                      
#>  lazyeval     0.2.0.9000  2016-10-24 Github (hadley/lazyeval@c155c3d)    
#>  lubridate    1.6.0       2016-09-13 cran (@1.6.0)                       
#>  magrittr     1.5         2014-11-22 CRAN (R 3.2.0)                      
#>  memoise      1.0.0.9001  2016-12-18 Github (hadley/memoise@884d565)     
#>  mnormt       1.5-5       2016-10-15 CRAN (R 3.3.0)                      
#>  modelr       0.1.0       2016-08-31 CRAN (R 3.3.0)                      
#>  munsell      0.4.3       2016-02-13 CRAN (R 3.3.0)                      
#>  nlme         3.1-128     2016-05-10 CRAN (R 3.3.2)                      
#>  pkgbuild     0.0.0.9000  2017-04-13 Github (r-pkgs/pkgbuild@8aab60b)    
#>  pkgload      0.0.0.9000  2017-04-13 Github (r-pkgs/pkgload@9093b96)     
#>  plyr         1.8.4       2016-06-08 CRAN (R 3.3.0)                      
#>  psych        1.6.12      2017-01-08 cran (@1.6.12)                      
#>  purrr      * 0.2.2.9000  2017-04-10 Github (hadley/purrr@b8e3942)       
#>  R6           2.2.0       2016-10-05 CRAN (R 3.3.0)                      
#>  Rcpp         0.12.10     2017-04-13 Github (RcppCore/Rcpp@21d8388)      
#>  readr      * 1.1.0       2017-03-22 CRAN (R 3.3.2)                      
#>  readxl     * 0.1.1.9000  2017-04-14 local                               
#>  rematch      1.0.1       2016-04-21 CRAN (R 3.2.3)                      
#>  reshape2     1.4.2       2016-10-22 CRAN (R 3.3.0)                      
#>  rlang        0.0.0.9014  2017-04-13 Github (hadley/rlang@ac7498c)       
#>  rmarkdown    1.4.0.9001  2017-04-13 Github (rstudio/rmarkdown@f2788b8)  
#>  rprojroot    1.2         2017-01-16 CRAN (R 3.3.2)                      
#>  rvest        0.3.2       2016-06-17 CRAN (R 3.3.0)                      
#>  scales       0.4.1       2016-11-09 CRAN (R 3.3.2)                      
#>  stringi      1.1.5       2017-04-07 cran (@1.1.5)                       
#>  stringr      1.2.0       2017-02-18 cran (@1.2.0)                       
#>  tibble     * 1.3.0       2017-04-01 cran (@1.3.0)                       
#>  tidyr      * 0.6.1.9000  2017-03-07 Github (hadley/tidyr@0f9a5da)       
#>  tidyverse  * 1.1.1.9000  2017-03-17 Github (tidyverse/tidyverse@2771fd7)
#>  withr        1.0.2       2016-06-20 cran (@1.0.2)                       
#>  xml2         1.1.1       2017-03-31 Github (hadley/xml2@268387b)        
#>  yaml         2.1.14      2016-11-12 cran (@2.1.14)
```
</details>

-->
</div>
<div id="base-version" class="section level2">
<h2 class="hasAnchor">
<a href="#base-version" class="anchor"></a>Base version</h2>
<p>Rework examples from above but using base R only, other than readxl.</p>
<div id="cache-a-csv-snapshot-1" class="section level3">
<h3 class="hasAnchor">
<a href="#cache-a-csv-snapshot-1" class="anchor"></a>Cache a CSV snapshot</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_xl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>), <span class="dt">sheet =</span> <span class="st">"iris"</span>)
<span class="kw">write.csv</span>(iris_xl, <span class="st">"iris-raw.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)
iris_alt &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"iris-raw.csv"</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
## coerce iris_xl back to a data.frame
<span class="kw">identical</span>(<span class="kw">as.data.frame</span>(iris_xl), iris_alt)</code></pre></div>
</div>
<div id="iterate-over-multiple-worksheets-in-a-workbook-1" class="section level3">
<h3 class="hasAnchor">
<a href="#iterate-over-multiple-worksheets-in-a-workbook-1" class="anchor"></a>Iterate over multiple worksheets in a workbook</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xls"</span>)
sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)
xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path), read_excel, <span class="dt">path =</span> path) 
<span class="kw">names</span>(xl_list) &lt;-<span class="st"> </span>sheets</code></pre></div>
</div>
<div id="csv-caching-and-iterating-over-sheets-1" class="section level3">
<h3 class="hasAnchor">
<a href="#csv-caching-and-iterating-over-sheets-1" class="anchor"></a>CSV caching and iterating over sheets</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_then_csv &lt;-<span class="st"> </span>function(sheet, path) {
  pathbase &lt;-<span class="st"> </span>tools::<span class="kw">file_path_sans_ext</span>(<span class="kw">basename</span>(path))
  df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">path =</span> path, <span class="dt">sheet =</span> sheet)
  <span class="kw">write.csv</span>(df, <span class="kw">paste0</span>(pathbase, <span class="st">"-"</span>, sheet, <span class="st">".csv"</span>),
            <span class="dt">quote =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
  df
}
path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>)
sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)
xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path), read_then_csv, <span class="dt">path =</span> path)
<span class="kw">names</span>(xl_list) &lt;-<span class="st"> </span>sheets</code></pre></div>
</div>
<div id="concatenate-worksheets-into-one-data-frame-1" class="section level3">
<h3 class="hasAnchor">
<a href="#concatenate-worksheets-into-one-data-frame-1" class="anchor"></a>Concatenate worksheets into one data frame</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)
sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)
xl_list &lt;-
<span class="st">  </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path), read_excel, <span class="dt">path =</span> path, <span class="dt">range =</span> <span class="st">"A5:F15"</span>)
xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">seq_along</span>(sheets), function(i) {
  <span class="kw">data.frame</span>(<span class="dt">sheet =</span> <span class="kw">I</span>(sheets[i]), xl_list[[i]])
})
xl_list &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, xl_list)</code></pre></div>
</div>
<div id="putting-it-all-together-1" class="section level3">
<h3 class="hasAnchor">
<a href="#putting-it-all-together-1" class="anchor"></a>Putting it all together</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)
sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)
ranges &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">"A5:F15"</span>, <span class="kw"><a href="../../reference/cell-specification.html">cell_rows</a></span>(<span class="dv">5</span>:<span class="dv">15</span>))
xl_list &lt;-<span class="st"> </span><span class="kw">mapply</span>(function(x, y) {
  <span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">path =</span> path, <span class="dt">sheet =</span> x, <span class="dt">range =</span> y)
}, sheets, ranges, <span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>)
xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">seq_along</span>(sheets), function(i) {
  <span class="kw">data.frame</span>(<span class="dt">sheet =</span> <span class="kw">I</span>(sheets[i]), xl_list[[i]])
})
xl_list &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, xl_list)
<span class="kw">write.csv</span>(xl_list, <span class="st">"deaths.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages">Load packages</a></li>
      <li><a href="#cache-a-csv-snapshot">Cache a CSV snapshot</a></li>
      <li><a href="#iterate-over-multiple-worksheets-in-a-workbook">Iterate over multiple worksheets in a workbook</a></li>
      <li><a href="#csv-caching-and-iterating-over-sheets">CSV caching and iterating over sheets</a></li>
      <li><a href="#concatenate-worksheets-into-one-data-frame">Concatenate worksheets into one data frame</a></li>
      <li><a href="#putting-it-all-together">Putting it all together</a></li>
      <li><a href="#base-version">Base version</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>readxl is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Jennifer Bryan, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" height="24"></a>.</p>
  <p>Site built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>
      </footer>
</div>

  </body>
</html>
