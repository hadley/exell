<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>readxl Workflows • readxl</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- tidyverse --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">readxl</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/cell-and-column-types.html">Column Types</a>
    </li>
    <li>
      <a href="../../articles/sheet-geometry.html">Sheet Geometry</a>
    </li>
    <li>
      <a href="../../articles/articles/readxl-workflows.html">Workflows</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Release notes</li>
    <li>
      <a href="../../articles/releases/readxl-1.0.0.html">Version 1.0.0</a>
    </li>
    <li>
      <a href="../../articles/releases/readxl-0.1.1.html">Version 0.1.1</a>
    </li>
    <li>
      <a href="../../articles/releases/readxl-0.1.0.html">Version 0.1.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/readxl">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>readxl Workflows</h1>
            
      
      <small>Source: <a href="https://github.com/tidyverse/readxl/blob/master/vignettes/articles/readxl-workflows.Rmd"><code>vignettes/articles/readxl-workflows.Rmd</code></a></small>
      <div class="hidden name"><code>readxl-workflows.Rmd</code></div>

    </div>

    
    
<p>Ideas for using readxl to increase reproducibiliy and reduce tedium.</p>
<p>Reproducibility is much easier in theory than in reality. Here are some special dilemmas we face with spreadsheets:</p>
<ul>
<li>We say: Keep raw data raw! But we also say: Store data in a tool-agnostic, future-proof format! If data comes in the form of an <code>.xls[x]</code> file, we’re in a pickle. The <code>.xls[x]</code> file should obviously be preserved, and probably write-protected. But a faithful copy as CSV is a wonderful complement, as long as you can ensure the two are the same.</li>
<li>We say: Don’t do analysis “by hand” or “by mouse”! But then we break this rule by manually exporting spreadsheets to file with <em>File &gt; Save As … &gt; (save to <code>.csv</code>)</em>. readxl helps you get data directly out of a spreadsheet and into R, where you can record every step of your analysis as code. Below we show how to cache a CSV snapshot as part of this process.</li>
</ul>
<p>The examples below also demonstrate the use of functional programming or “apply” techniques to iterate over the worksheets in a workbook.</p>
<div id="load-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h2>
<p>We load the tidyverse metapackage here because the workflows below show readxl working with readr, purrr, etc. See the last section for solutions using base R only (other than readxl).</p>
<p>We must load readxl explicitly because it is not part of the core tidyverse.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; ── Attaching packages ───────────────────────────────────────── tidyverse 1.2.1 ──</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; ✔ ggplot2 2.2.1          ✔ purrr   0.2.4.9000</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; ✔ tibble  1.4.2          ✔ dplyr   0.7.4.9000</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; ✔ tidyr   0.8.0          ✔ stringr 1.3.0     </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; ✔ readr   1.2.0          ✔ forcats 0.3.0</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; ── Conflicts ──────────────────────────────────────────── tidyverse_conflicts() ──</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">library</span>(readxl)</a></code></pre></div>
</div>
<div id="cache-a-csv-snapshot" class="section level2">
<h2 class="hasAnchor">
<a href="#cache-a-csv-snapshot" class="anchor"></a>Cache a CSV snapshot</h2>
<p>Break analyses into logical steps, via a series of scripts that relate to one theme, such as “clean the data” or “make exploratory and diagnostic plots”.</p>
<p>This forces you to transmit info from step i to step i + 1 via a set of output files. The cumulative outputs of steps 1, 2, …, i are available as inputs for steps i + 1 and beyond.</p>
<p>These outputs constitute <a href="https://www.quora.com/What-is-an-API-4">an API</a> for your analysis, i.e. they provide clean entry points that can be used (and understood) in isolation, possibly using an entirely different toolkit. Contrast this with the alternative of writing one monolithic script or transmitting entire workspaces via <code>save()</code>, <code>load()</code>, and R-specific <code>.rds</code> files.</p>
<p>If raw data is stored <em>only</em> as an Excel spreadsheet, this limits your ability to inspect it when solving the little puzzles that crop up in dowstream work. You’ll need to fire up Excel (or similar) and get busy with your mouse. You certainly can’t poke around it or view diffs on GitHub.</p>
<p>Solution: cache a CSV snapshot of your raw data tables at the time of export. Even if you use <code><a href="../../reference/read_excel.html">read_excel()</a></code> for end-to-end reproducibility, this complementary CSV leaves your analysis in a more accessible state.</p>
<p>Pipe the output of <code><a href="../../reference/read_excel.html">read_excel()</a></code> directly into <code><a href="http://www.rdocumentation.org/packages/readr/topics/write_delim">readr::write_csv()</a></code> like so:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">iris_xl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">sheet =</span> <span class="st">"iris"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw">write_csv</span>(<span class="st">"iris-raw.csv"</span>)</a></code></pre></div>
<p>Why does this work? <code><a href="http://www.rdocumentation.org/packages/readr/topics/write_delim">readr::write_csv()</a></code> is a well-mannered “write” function: it does its main job <em>and returns its input invisibly</em>. The above command reads the iris sheet from readxl’s <code>datasets.xlsx</code> example workbook and caches a CSV version of the resulting data frame to file.</p>
<p>Let’s check. Did we still import the data? Did we write the CSV file?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">iris_xl</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; # A tibble: 150 x 5</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; 1         5.10        3.50         1.40       0.200 setosa </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; 2         4.90        3.00         1.40       0.200 setosa </span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; 3         4.70        3.20         1.30       0.200 setosa </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; # ... with 147 more rows</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">dir</span>(<span class="dt">pattern =</span> <span class="st">"iris"</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; [1] "iris-raw.csv"</span></a></code></pre></div>
<p>Yes! Is the data written to CSV an exact copy of what we imported from Excel?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">iris_alt &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"iris-raw.csv"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;   Sepal.Length = col_double(),</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;   Sepal.Width = col_double(),</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;   Petal.Length = col_double(),</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;   Petal.Width = col_double(),</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;   Species = col_character()</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">## readr leaves a note-to-self in `spec` that records its column guessing,</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">## so we remove that attribute before the check</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="kw">attr</span>(iris_alt, <span class="st">"spec"</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="kw">identical</span>(iris_xl, iris_alt)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>Yes! If we needed to restart or troubleshoot this fictional analysis, <code>iris-raw.csv</code> is available as a second, highly accessible alternative to <code>datasets.xlsx</code>.</p>
</div>
<div id="iterate-over-multiple-worksheets-in-a-workbook" class="section level2">
<h2 class="hasAnchor">
<a href="#iterate-over-multiple-worksheets-in-a-workbook" class="anchor"></a>Iterate over multiple worksheets in a workbook</h2>
<p>Some Excel workbooks contain only data and you are tempted to ask “Why, God, why is this data stored in Excel? Why not store this as a series of CSV files?” One possible answer is this: because the workbook structure keeps them all together.</p>
<p>Let’s accept that this happens and that it is not entirely crazy. How can you efficiently load all of that into R?</p>
<p>Here’s how to load all the sheets in a workbook into a list of data frames:</p>
<ul>
<li>Get worksheet names as a self-named character vector (these names propagate nicely).</li>
<li>Use <code><a href="http://www.rdocumentation.org/packages/purrr/topics/map">purrr::map()</a></code> to iterate sheet reading.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">path <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw">set_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw">map</span>(read_excel, <span class="dt">path =</span> path)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; $iris</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; # A tibble: 150 x 5</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; 1         5.10        3.50         1.40       0.200 setosa </span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; 2         4.90        3.00         1.40       0.200 setosa </span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; 3         4.70        3.20         1.30       0.200 setosa </span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; # ... with 147 more rows</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; $mtcars</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; # A tibble: 32 x 11</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; 1  21.0    6.  160.  110.  3.90  2.62  16.5    0.    1.    4.    4.</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; 2  21.0    6.  160.  110.  3.90  2.88  17.0    0.    1.    4.    4.</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; 3  22.8    4.  108.   93.  3.85  2.32  18.6    1.    1.    4.    1.</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; # ... with 29 more rows</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt; $chickwts</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; # A tibble: 71 x 2</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt;   weight feed     </span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;    </span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; 1   179. horsebean</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt; 2   160. horsebean</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt; 3   136. horsebean</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="co">#&gt; # ... with 68 more rows</span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-33" data-line-number="33"><span class="co">#&gt; $quakes</span></a>
<a class="sourceLine" id="cb5-34" data-line-number="34"><span class="co">#&gt; # A tibble: 1,000 x 5</span></a>
<a class="sourceLine" id="cb5-35" data-line-number="35"><span class="co">#&gt;     lat  long depth   mag stations</span></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-37" data-line-number="37"><span class="co">#&gt; 1 -20.4  182.  562.  4.80      41.</span></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="co">#&gt; 2 -20.6  181.  650.  4.20      15.</span></a>
<a class="sourceLine" id="cb5-39" data-line-number="39"><span class="co">#&gt; 3 -26.0  184.   42.  5.40      43.</span></a>
<a class="sourceLine" id="cb5-40" data-line-number="40"><span class="co">#&gt; # ... with 997 more rows</span></a></code></pre></div>
</div>
<div id="csv-caching-and-iterating-over-sheets" class="section level2">
<h2 class="hasAnchor">
<a href="#csv-caching-and-iterating-over-sheets" class="anchor"></a>CSV caching and iterating over sheets</h2>
<p>What if we want to read all the sheets in at once and simultaneously cache to CSV? We define <code>read_then_csv()</code> as <code>read_excel(...) %&gt;% write_csv()</code> and use <code><a href="http://www.rdocumentation.org/packages/purrr/topics/map">purrr::map()</a></code> again.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">read_then_csv &lt;-<span class="st"> </span><span class="cf">function</span>(sheet, path) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  pathbase &lt;-<span class="st"> </span>path <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">    </span><span class="kw">basename</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">    </span>tools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tools/topics/fileutils">file_path_sans_ext</a></span>()</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  path <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">sheet =</span> sheet) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">    </span><span class="kw">write_csv</span>(<span class="kw">paste0</span>(pathbase, <span class="st">"-"</span>, sheet, <span class="st">".csv"</span>))</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">}</a></code></pre></div>
<p>We could even define this on-the-fly as an anonymous function inside <code>map()</code>, but I think this is more readable.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">path <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw">set_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">map</span>(read_then_csv, <span class="dt">path =</span> path)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; $iris</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; # A tibble: 150 x 5</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; 1         5.10        3.50         1.40       0.200 setosa </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; 2         4.90        3.00         1.40       0.200 setosa </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; 3         4.70        3.20         1.30       0.200 setosa </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; # ... with 147 more rows</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; $mtcars</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; # A tibble: 32 x 11</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; 1  21.0    6.  160.  110.  3.90  2.62  16.5    0.    1.    4.    4.</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; 2  21.0    6.  160.  110.  3.90  2.88  17.0    0.    1.    4.    4.</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; 3  22.8    4.  108.   93.  3.85  2.32  18.6    1.    1.    4.    1.</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; # ... with 29 more rows</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; $chickwts</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; # A tibble: 71 x 2</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt;   weight feed     </span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;    </span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; 1   179. horsebean</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; 2   160. horsebean</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; 3   136. horsebean</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; # ... with 68 more rows</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="co">#&gt; $quakes</span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34"><span class="co">#&gt; # A tibble: 1,000 x 5</span></a>
<a class="sourceLine" id="cb7-35" data-line-number="35"><span class="co">#&gt;     lat  long depth   mag stations</span></a>
<a class="sourceLine" id="cb7-36" data-line-number="36"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-37" data-line-number="37"><span class="co">#&gt; 1 -20.4  182.  562.  4.80      41.</span></a>
<a class="sourceLine" id="cb7-38" data-line-number="38"><span class="co">#&gt; 2 -20.6  181.  650.  4.20      15.</span></a>
<a class="sourceLine" id="cb7-39" data-line-number="39"><span class="co">#&gt; 3 -26.0  184.   42.  5.40      43.</span></a>
<a class="sourceLine" id="cb7-40" data-line-number="40"><span class="co">#&gt; # ... with 997 more rows</span></a>
<a class="sourceLine" id="cb7-41" data-line-number="41"><span class="kw">dir</span>(<span class="dt">pattern =</span> <span class="st">"^datasets.*</span><span class="ch">\\</span><span class="st">.csv$"</span>)</a>
<a class="sourceLine" id="cb7-42" data-line-number="42"><span class="co">#&gt; [1] "datasets-chickwts.csv" "datasets-iris.csv"     "datasets-mtcars.csv"  </span></a>
<a class="sourceLine" id="cb7-43" data-line-number="43"><span class="co">#&gt; [4] "datasets-quakes.csv"</span></a></code></pre></div>
<p>In a real analysis, starting with workbook <code>"foo.xlsx"</code>, you might want to create the directory <code>foo</code> and place the CSVs inside that.</p>
</div>
<div id="concatenate-worksheets-into-one-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#concatenate-worksheets-into-one-data-frame" class="anchor"></a>Concatenate worksheets into one data frame</h2>
<p>What if the datasets found on different sheets have the same variables? Then you’ll want to row-bind them, after import, to form one big, beautiful data frame.</p>
<p>readxl ships with an example sheet <code>deaths.xlsx</code>, containing data on famous people who died in 2016 or 2017. It has two worksheets named “arts” and “other”, but the spreadsheet layout is the same in each and the data tables have the same variables, e.g., name and date of death.</p>
<p>The <code>map_df()</code> function from purrr makes it easy to iterate over worksheets and glue together the resulting data frames, all at once.</p>
<ul>
<li>Store a self-named vector of worksheet names (critical for the ID variable below).</li>
<li>Use <code><a href="http://www.rdocumentation.org/packages/purrr/topics/map">purrr::map_df()</a></code> to import the data, create an ID variable for the source worksheet, and row bind.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">deaths &lt;-<span class="st"> </span>path <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">set_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw">map_df</span>(<span class="op">~</span><span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">path =</span> path, <span class="dt">sheet =</span> .x, <span class="dt">range =</span> <span class="st">"A5:F15"</span>), <span class="dt">.id =</span> <span class="st">"sheet"</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw">print</span>(deaths, <span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; # A tibble: 20 x 7</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;    sheet Name              Profession   Age `Has kids` `Date of birth`    </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;chr&gt;      &lt;dbl&gt; &lt;lgl&gt;      &lt;dttm&gt;             </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  1 arts  David Bowie       musician     69. TRUE       1947-01-08 00:00:00</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  2 arts  Carrie Fisher     actor        60. TRUE       1956-10-21 00:00:00</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  3 arts  Chuck Berry       musician     90. TRUE       1926-10-18 00:00:00</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  4 arts  Bill Paxton       actor        61. TRUE       1955-05-17 00:00:00</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  5 arts  Prince            musician     57. TRUE       1958-06-07 00:00:00</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  6 arts  Alan Rickman      actor        69. FALSE      1946-02-21 00:00:00</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;  7 arts  Florence Henders… actor        82. TRUE       1934-02-14 00:00:00</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  8 arts  Harper Lee        author       89. FALSE      1926-04-28 00:00:00</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;  9 arts  Zsa Zsa Gábor     actor        99. TRUE       1917-02-06 00:00:00</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 10 arts  George Michael    musician     53. FALSE      1963-06-25 00:00:00</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; 11 other Vera Rubin        scientist    88. TRUE       1928-07-23 00:00:00</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt; 12 other Mohamed Ali       athlete      74. TRUE       1942-01-17 00:00:00</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt; 13 other Morley Safer      journalist   84. TRUE       1931-11-08 00:00:00</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; 14 other Fidel Castro      politician   90. TRUE       1926-08-13 00:00:00</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt; 15 other Antonin Scalia    lawyer       79. TRUE       1936-03-11 00:00:00</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt; 16 other Jo Cox            politician   41. TRUE       1974-06-22 00:00:00</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt; 17 other Janet Reno        lawyer       78. FALSE      1938-07-21 00:00:00</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; 18 other Gwen Ifill        journalist   61. FALSE      1955-09-29 00:00:00</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt; 19 other John Glenn        astronaut    95. TRUE       1921-07-28 00:00:00</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt; 20 other Pat Summit        coach        64. TRUE       1952-06-14 00:00:00</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt; # ... with 1 more variable: `Date of death` &lt;dttm&gt;</span></a></code></pre></div>
<p>Note the use of <code>range = "A5:E15"</code> here. <code>deaths.xlsx</code> is a typical spreadsheet and includes a few non-data lines at the top and bottom and this argument specifies where the data rectangle lives.</p>
</div>
<div id="putting-it-all-together" class="section level2">
<h2 class="hasAnchor">
<a href="#putting-it-all-together" class="anchor"></a>Putting it all together</h2>
<p>All at once now:</p>
<ul>
<li>Multiple worksheets feeding into one data frame</li>
<li>Sheet-specific target rectangles</li>
<li>Cache to CSV upon import</li>
</ul>
<p>Even though the worksheets in <code>deaths.xlsx</code> have the same layout, we’ll pretend they don’t and specify the target rectangle in two different ways here. This shows how this can work if each worksheet has it’s own peculiar geometry. Here’s the workflow:</p>
<ul>
<li>Store a self-named vector of worksheet names.</li>
<li>Store a vector of cell range specifications.</li>
<li>Use <code><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">purrr::map2_df()</a></code> to iterate over those two vectors in parallel, importing the data, row binding, and creating an ID variable for the source worksheet.</li>
<li>Cache the unified data to CSV.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">sheets &lt;-<span class="st"> </span>path <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw">set_names</span>()</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">ranges &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">"A5:F15"</span>, <span class="kw"><a href="../../reference/cell-specification.html">cell_rows</a></span>(<span class="dv">5</span><span class="op">:</span><span class="dv">15</span>))</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">deaths &lt;-<span class="st"> </span><span class="kw">map2_df</span>(</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  sheets,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  ranges,</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  <span class="op">~</span><span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(path, <span class="dt">sheet =</span> .x, <span class="dt">range =</span> .y),</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  <span class="dt">.id =</span> <span class="st">"sheet"</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">  </span><span class="kw">write_csv</span>(<span class="st">"deaths.csv"</span>)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="kw">print</span>(deaths, <span class="dt">n =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; # A tibble: 20 x 7</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;    sheet Name  Profession   Age `Has kids` `Date of birth` `Date of death`</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;lgl&gt;      &lt;chr&gt;           &lt;chr&gt;          </span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;  1 arts  Davi… musician     69. TRUE       1947-01-08T00:… 2016-01-10T00:…</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt;  2 arts  Carr… actor        60. TRUE       1956-10-21T00:… 2016-12-27T00:…</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;  3 arts  Chuc… musician     90. TRUE       1926-10-18T00:… 2017-03-18T00:…</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt;  4 arts  Bill… actor        61. TRUE       1955-05-17T00:… 2017-02-25T00:…</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt;  5 arts  Prin… musician     57. TRUE       1958-06-07T00:… 2016-04-21T00:…</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt;  6 arts  Alan… actor        69. FALSE      1946-02-21T00:… 2016-01-14T00:…</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt;  7 arts  Flor… actor        82. TRUE       1934-02-14T00:… 2016-11-24T00:…</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt;  8 arts  Harp… author       89. FALSE      1926-04-28T00:… 2016-02-19T00:…</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt;  9 arts  Zsa … actor        99. TRUE       1917-02-06T00:… 2016-12-18T00:…</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt; 10 arts  Geor… musician     53. FALSE      1963-06-25T00:… 2016-12-25T00:…</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt; 11 other Vera… scientist    88. TRUE       1928-07-23T00:… 2016-12-25T00:…</span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt; 12 other Moha… athlete      74. TRUE       1942-01-17T00:… 2016-06-03T00:…</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt; 13 other Morl… journalist   84. TRUE       1931-11-08T00:… 2016-05-19T00:…</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt; 14 other Fide… politician   90. TRUE       1926-08-13T00:… 2016-11-25T00:…</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt; 15 other Anto… lawyer       79. TRUE       1936-03-11T00:… 2016-02-13T00:…</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt; 16 other Jo C… politician   41. TRUE       1974-06-22T00:… 2016-06-16T00:…</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt; 17 other Jane… lawyer       78. FALSE      1938-07-21T00:… 2016-11-07T00:…</span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt; 18 other Gwen… journalist   61. FALSE      1955-09-29T00:… 2016-11-14T00:…</span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt; 19 other John… astronaut    95. TRUE       1921-07-28T00:… 2016-12-08T00:…</span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt; 20 other Pat … coach        64. TRUE       1952-06-14T00:… 2016-06-28T00:…</span></a></code></pre></div>
<!--

## Session info

<details>
<summary>devtools::session_info()</summary>

```r
devtools::session_info()
#> ─ Session info ──────────────────────────────────────────────────────────
#>  setting  value                       
#>  version  R version 3.4.3 (2017-11-30)
#>  os       macOS Sierra 10.12.6        
#>  system   x86_64, darwin15.6.0        
#>  ui       X11                         
#>  language (EN)                        
#>  collate  en_CA.UTF-8                 
#>  tz       America/Vancouver           
#>  date     2018-04-16                  
#> 
#> ─ Packages ──────────────────────────────────────────────────────────────
#>  package     * version     date       source                             
#>  ansistrings   1.0.0.9000  2018-04-02 Github (r-lib/ansistrings@4e4d309) 
#>  assertthat    0.2.0       2017-04-11 CRAN (R 3.4.0)                     
#>  backports     1.1.2       2018-04-14 Github (r-lib/backports@cee9348)   
#>  bindr         0.1.0.9000  2018-03-09 Github (krlmlr/bindr@4b20179)      
#>  bindrcpp      0.2.0.9000  2018-03-09 Github (krlmlr/bindrcpp@7553d4f)   
#>  broom         0.4.3       2017-11-20 CRAN (R 3.4.3)                     
#>  callr         2.0.3       2018-04-11 CRAN (R 3.4.4)                     
#>  cellranger    1.1.0.9000  2018-04-03 local                              
#>  cli           1.0.0.9002  2018-04-02 Github (r-lib/cli@c408924)         
#>  clisymbols    1.2.0       2017-05-21 CRAN (R 3.4.0)                     
#>  colorspace    1.3-2       2016-12-14 CRAN (R 3.4.0)                     
#>  commonmark    1.4         2017-09-01 CRAN (R 3.4.1)                     
#>  crayon        1.3.4       2018-04-02 Github (gaborcsardi/crayon@95b3eae)
#>  debugme       1.1.0.9000  2018-01-29 Github (r-lib/debugme@f4a116a)     
#>  desc          1.1.1.9003  2018-04-14 Github (r-lib/desc@387b732)        
#>  devtools      1.13.5.9000 2018-03-02 Github (r-lib/devtools@3068e65)    
#>  digest        0.6.15      2018-01-28 CRAN (R 3.4.3)                     
#>  dplyr       * 0.7.4.9000  2018-03-09 Github (tidyverse/dplyr@9f707d2)   
#>  evaluate      0.10.1      2017-06-24 CRAN (R 3.4.1)                     
#>  forcats     * 0.3.0       2018-02-19 CRAN (R 3.4.3)                     
#>  foreign       0.8-69      2017-06-22 CRAN (R 3.4.3)                     
#>  fs            1.2.2       2018-03-21 CRAN (R 3.4.4)                     
#>  ggplot2     * 2.2.1       2016-12-30 CRAN (R 3.4.0)                     
#>  glue          1.2.0.9000  2018-04-07 Github (tidyverse/glue@0699687)    
#>  gtable        0.2.0       2016-02-26 CRAN (R 3.4.0)                     
#>  haven         1.1.1       2018-01-18 CRAN (R 3.4.3)                     
#>  hms           0.4.2       2018-04-16 Github (tidyverse/hms@c0cfc01)     
#>  htmltools     0.3.6       2017-04-28 CRAN (R 3.4.0)                     
#>  httr          1.3.1       2017-08-20 CRAN (R 3.4.1)                     
#>  jsonlite      1.5         2017-06-01 CRAN (R 3.4.0)                     
#>  knitr         1.20        2018-02-20 CRAN (R 3.4.3)                     
#>  lattice       0.20-35     2017-03-25 CRAN (R 3.4.3)                     
#>  lazyeval      0.2.1       2017-10-29 CRAN (R 3.4.2)                     
#>  lubridate     1.7.2       2018-02-06 CRAN (R 3.4.3)                     
#>  magrittr      1.5         2014-11-22 CRAN (R 3.4.0)                     
#>  MASS          7.3-48      2017-12-25 CRAN (R 3.4.3)                     
#>  memoise       1.1.0       2018-01-15 Github (hadley/memoise@611cfad)    
#>  mnormt        1.5-5       2016-10-15 CRAN (R 3.4.0)                     
#>  modelr        0.1.1       2017-07-24 CRAN (R 3.4.1)                     
#>  munsell       0.4.3       2016-02-13 CRAN (R 3.4.0)                     
#>  nlme          3.1-131     2017-02-06 CRAN (R 3.4.3)                     
#>  pillar        1.2.1       2018-02-27 Github (r-lib/pillar@2065df9)      
#>  pkgbuild      1.0.0       2018-04-14 Github (r-lib/pkgbuild@4ee12af)    
#>  pkgconfig     2.0.1       2017-03-21 CRAN (R 3.4.0)                     
#>  pkgdown       0.1.0.9000  2018-04-14 Github (hadley/pkgdown@a7aa75e)    
#>  pkgload       1.0.0       2018-04-14 Github (r-lib/pkgload@a9184a0)     
#>  plyr          1.8.4       2016-06-08 CRAN (R 3.4.0)                     
#>  prettyunits   1.0.2       2015-07-13 CRAN (R 3.4.0)                     
#>  progress      1.1.2.9003  2018-04-02 Github (r-lib/progress@e525de4)    
#>  psych         1.7.8       2017-09-09 CRAN (R 3.4.3)                     
#>  purrr       * 0.2.4.9000  2018-03-29 Github (tidyverse/purrr@84ce1ad)   
#>  R6            2.2.2       2017-06-17 CRAN (R 3.4.0)                     
#>  Rcpp          0.12.16     2018-03-13 CRAN (R 3.4.4)                     
#>  readr       * 1.2.0       2018-04-16 Github (tidyverse/readr@23eb46d)   
#>  readxl      * 1.0.0.9000  2018-04-15 local                              
#>  rematch       1.0.1       2016-04-21 CRAN (R 3.4.0)                     
#>  reshape2      1.4.3       2017-12-11 CRAN (R 3.4.3)                     
#>  rlang         0.2.0.9001  2018-04-02 Github (tidyverse/rlang@49d7a34)   
#>  rmarkdown     1.9.8       2018-03-31 Github (rstudio/rmarkdown@8cfc878) 
#>  roxygen2      6.0.1.9000  2018-03-01 local                              
#>  rprojroot     1.3-2       2018-01-03 CRAN (R 3.4.2)                     
#>  rstudioapi    0.7.0-9000  2018-01-12 Github (rstudio/rstudioapi@109e593)
#>  rvest         0.3.2       2016-06-17 CRAN (R 3.4.0)                     
#>  scales        0.5.0       2017-08-24 CRAN (R 3.4.1)                     
#>  selectr       0.4-0       2018-03-27 CRAN (R 3.4.3)                     
#>  sessioninfo   1.0.1.9000  2017-10-26 Github (r-lib/sessioninfo@c871d01) 
#>  stringi       1.1.7       2018-03-12 CRAN (R 3.4.4)                     
#>  stringr     * 1.3.0       2018-02-19 CRAN (R 3.4.3)                     
#>  testthat      2.0.0       2017-12-13 CRAN (R 3.4.3)                     
#>  tibble      * 1.4.2       2018-02-27 Github (tidyverse/tibble@80ac1a3)  
#>  tidyr       * 0.8.0       2018-01-29 CRAN (R 3.4.3)                     
#>  tidyselect    0.2.4       2018-02-26 CRAN (R 3.4.3)                     
#>  tidyverse   * 1.2.1       2017-11-14 CRAN (R 3.4.2)                     
#>  usethis       1.3.0.9000  2018-04-14 Github (r-lib/usethis@9ab0e79)     
#>  utf8          1.1.3       2018-01-03 CRAN (R 3.4.2)                     
#>  withr         2.1.2       2018-03-18 Github (r-lib/withr@79d7b0d)       
#>  xml2          1.2.0       2018-01-24 CRAN (R 3.4.3)                     
#>  yaml          2.1.18      2018-03-08 CRAN (R 3.4.4)
```
</details>

-->
</div>
<div id="base-version" class="section level2">
<h2 class="hasAnchor">
<a href="#base-version" class="anchor"></a>Base version</h2>
<p>Rework examples from above but using base R only, other than readxl.</p>
<div id="cache-a-csv-snapshot-1" class="section level3">
<h3 class="hasAnchor">
<a href="#cache-a-csv-snapshot-1" class="anchor"></a>Cache a CSV snapshot</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">iris_xl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>), <span class="dt">sheet =</span> <span class="st">"iris"</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">write.csv</span>(iris_xl, <span class="st">"iris-raw.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">iris_alt &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"iris-raw.csv"</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">## coerce iris_xl back to a data.frame</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">identical</span>(<span class="kw">as.data.frame</span>(iris_xl), iris_alt)</a></code></pre></div>
</div>
<div id="iterate-over-multiple-worksheets-in-a-workbook-1" class="section level3">
<h3 class="hasAnchor">
<a href="#iterate-over-multiple-worksheets-in-a-workbook-1" class="anchor"></a>Iterate over multiple worksheets in a workbook</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xls"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path), read_excel, <span class="dt">path =</span> path) </a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">names</span>(xl_list) &lt;-<span class="st"> </span>sheets</a></code></pre></div>
</div>
<div id="csv-caching-and-iterating-over-sheets-1" class="section level3">
<h3 class="hasAnchor">
<a href="#csv-caching-and-iterating-over-sheets-1" class="anchor"></a>CSV caching and iterating over sheets</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">read_then_csv &lt;-<span class="st"> </span><span class="cf">function</span>(sheet, path) {</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  pathbase &lt;-<span class="st"> </span>tools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tools/topics/fileutils">file_path_sans_ext</a></span>(<span class="kw">basename</span>(path))</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">path =</span> path, <span class="dt">sheet =</span> sheet)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="kw">write.csv</span>(df, <span class="kw">paste0</span>(pathbase, <span class="st">"-"</span>, sheet, <span class="st">".csv"</span>),</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">            <span class="dt">quote =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  df</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"datasets.xlsx"</span>)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path), read_then_csv, <span class="dt">path =</span> path)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="kw">names</span>(xl_list) &lt;-<span class="st"> </span>sheets</a></code></pre></div>
</div>
<div id="concatenate-worksheets-into-one-data-frame-1" class="section level3">
<h3 class="hasAnchor">
<a href="#concatenate-worksheets-into-one-data-frame-1" class="anchor"></a>Concatenate worksheets into one data frame</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">xl_list &lt;-</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path), read_excel, <span class="dt">path =</span> path, <span class="dt">range =</span> <span class="st">"A5:F15"</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">seq_along</span>(sheets), <span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  <span class="kw">data.frame</span>(<span class="dt">sheet =</span> <span class="kw">I</span>(sheets[i]), xl_list[[i]])</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">})</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">xl_list &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, xl_list)</a></code></pre></div>
</div>
<div id="putting-it-all-together-1" class="section level3">
<h3 class="hasAnchor">
<a href="#putting-it-all-together-1" class="anchor"></a>Putting it all together</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/readxl_example.html">readxl_example</a></span>(<span class="st">"deaths.xlsx"</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">sheets &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/excel_sheets.html">excel_sheets</a></span>(path)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">ranges &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">"A5:F15"</span>, <span class="kw"><a href="../../reference/cell-specification.html">cell_rows</a></span>(<span class="dv">5</span><span class="op">:</span><span class="dv">15</span>))</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">xl_list &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="kw"><a href="../../reference/read_excel.html">read_excel</a></span>(<span class="dt">path =</span> path, <span class="dt">sheet =</span> x, <span class="dt">range =</span> y)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">}, sheets, ranges, <span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">xl_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">seq_along</span>(sheets), <span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">  <span class="kw">data.frame</span>(<span class="dt">sheet =</span> <span class="kw">I</span>(sheets[i]), xl_list[[i]])</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">})</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">xl_list &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, xl_list)</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="kw">write.csv</span>(xl_list, <span class="st">"deaths.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages">Load packages</a></li>
      <li><a href="#cache-a-csv-snapshot">Cache a CSV snapshot</a></li>
      <li><a href="#iterate-over-multiple-worksheets-in-a-workbook">Iterate over multiple worksheets in a workbook</a></li>
      <li><a href="#csv-caching-and-iterating-over-sheets">CSV caching and iterating over sheets</a></li>
      <li><a href="#concatenate-worksheets-into-one-data-frame">Concatenate worksheets into one data frame</a></li>
      <li><a href="#putting-it-all-together">Putting it all together</a></li>
      <li><a href="#base-version">Base version</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>readxl is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Jennifer Bryan, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.</p>
  <p>Site built by <a href="http://pkgdown.r-lib.org">pkgdown</a>.</p>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script></footer>
</div>

  

  </body>
</html>
